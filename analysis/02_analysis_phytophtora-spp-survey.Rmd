---
title: "Analysis Phytophthora spp. survey"
author: "Daniel Cerritos"
date: "4/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library}
# install.packages(c("cowplot", "googleway", "ggrepel","ggspatial", "libwgeom", "sf", "rnaturalearth", "rnaturalearthdata"))

# devtools::install_github("yutannihilation/ggsflabel")

library(here)
library(tidyverse)
library(ggplot2)
library(sf)
library(maps)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggrepel)
library(cowplot)
library(ggsflabel)
```

# Import data

```{r data}
# samples collection
soil.samples <- read_csv(here("output", "clean_data", "01_soil-samples-2016-2017_clean-data.csv"))
plant.samples <- read_csv(here("output", "clean_data", "01_plant-samples-2018_clean-data.csv"))
```

# Exploratotry analysis

```{r exp analysis}
# 2016-2017: soil samples
# 2018: plants
samples %>%
  group_by(year) %>% 
  count() 

samples$county %>% 
  n_distinct() # 47 counties sampled 
```

# sample collection map

```{r samples map}
# https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-2.html use code from here


# fields where soil samples were collected
soil.samples <- soil.samples %>% 
  select(year, long, lat) %>% 
  filter(!is.na(long))
# convert to sf object
soil.samples <- st_as_sf(soil.samples, coords = c("long", "lat"), 
                   crs = 4326, agr = "constant")

world <- ne_countries(scale = "medium", returnclass = "sf")
states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

counties <- st_as_sf(map("county", plot = FALSE, fill = TRUE))
counties <- subset(counties, grepl("illinois", counties$ID))

counties.list <- counties$ID

# save counties geom points and add manually plant samples data
write.csv(counties.list, here("output", "add_plant-samples-and-isolates-data.csv"))

# add data
all_data <- read.csv(here("output", "isolates.csv")) # correct these code, dont do it manually

all_data <- inner_join(counties, all_data, by = "ID")
  
soil.samples$year <- as.factor(soil.samples$year)

label <- all_data %>% 
  filter(ID %in% c("illinois,boone", "illinois,champaign", "illinois,crawford", "illinois,grundy", 
                   "illinois,jefferson", "illinois,kankakee", "illinois,knox", "illinois,macon", 
                   "illinois,madison", "illinois,massac", "illinois,morgan", "illinois,vermilion")) %>% 
  separate(ID, into = c("state", "county"), sep = ",")

# map 
ggplot(data = world) +
  geom_sf(data = states, fill = NA) + 
  geom_sf(data = all_data, aes(fill = plant_samples), color = "black") +
  geom_sf(data = soil.samples, aes(shape = year),  size = 4) +
  coord_sf(xlim = c(-92, -87), ylim = c(36.5, 43), expand = FALSE) +
  scale_fill_gradient(high = "#2171b5", low = "#bdd7e7") +
  geom_sf_text_repel(data = label, aes(label = county), 
                      force = 100, nudge_x = -2, seed = 10)
```

# Isolates collected map 



