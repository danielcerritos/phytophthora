---
title: "Analysis Phytophthora spp. survey"
author: "Daniel Cerritos"
date: "4/24/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library}
# install.packages(c("googleway", "ggrepel","ggspatial", "libwgeom", "sf", "rnaturalearth", 
# "rnaturalearthdata","hagis", "corrplot", "Hmisc", "drc", "rgeos"))
# install.packages("pacman")
pacman::p_load(tidyverse, here, sf, maps, rnaturalearth, rnaturalearthdata, 
               cowplot, hagis, pander, lmerTest, ggResidpanel, emmeans, broom, 
               Hmisc, corrplot, drc)
```

# Import data

```{r data}
all_data <- list.files(here("output", "clean_data"), full.names = TRUE)
# samples collection
soil_samples <- read_csv(all_data[8])
plant_samples <- read_csv(all_data[7])
# identification of isolates
isolates_recovered <- read_csv(here("data", "all-isolates-in-data-base.csv"))
# pathotype
sojae <- read_csv(all_data[6])
sansomeana <- read_csv(all_data[5])
#aggressiveness
dry_weigth <- read_csv(all_data[1])
area_length <- read_csv(all_data[2])
# fungicide sensitivity 
fungicide <- read.csv(all_data[4])
```

# Sample collection

```{r soil samples}
# 2016-2017
soil_samples %>%
  group_by(year) %>% 
  count() 

soil_samples %>%
  group_by(year) %>% 
  count(county) %>% 
  ggplot(aes(x = fct_reorder(county, n), y = n, fill = as.factor(year))) +
  geom_col(color = "white", alpha = 0.8) +
  coord_flip() +
  labs(x = "", y ="Soil samples") +
  scale_fill_discrete(name = "Year") +
  scale_fill_manual(values =  c("#33a02c", "#1f78b4")) +
  theme_minimal()
```

```{r plant samples}
# 2018
plant_samples %>%
  count() # just included positive samples 

plant_samples %>%
  count(county) %>% 
  ggplot(aes(x = fct_reorder(county, n), y = n)) +
  geom_col(fill = "steelblue", alpha = 0.8) +
  coord_flip() +
  labs(x = "", y ="Plant samples") +
  theme_minimal()
```

## Map

```{r samples data map}
# subset county data 
world <- ne_countries(scale = "medium", returnclass = "sf")
states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))
counties <- st_as_sf(map("county", plot = FALSE, fill = TRUE))
counties <- subset(counties, grepl("illinois", counties$ID))

# convert to sf object
map_soil <- soil_samples %>% 
  filter(!sample_id == "16PR012") %>% # not from IL
  dplyr::select(year, long, lat) %>% 
  filter(!is.na(long))

map_soil <- st_as_sf(map_soil, coords = c("long", "lat"), 
                   crs = 4326, agr = "constant")

# change continuous data (plant samples) into categories 
map_plant <- plant_samples %>% 
  group_by(county) %>% 
  count() %>% 
  mutate(samples_categ = case_when(
    n <= 5 ~ "1-5", 
    n >= 6 & n <= 10 ~ "6-10",
    n >= 11 & n <= 15 ~ "11-15", 
    n >= 16 & n <= 20 ~ "16-20", 
  ))

# add counties coordinates to plant samples data
counties <- counties %>% 
  separate(ID, into = c("state", "county"), sep = ",")

map_plant$county <- tolower(map_plant$county)
map_plant <- left_join(counties, map_plant, by = "county")

# as factor for plotting
map_plant$samples_categ <- as.factor(map_plant$samples_categ)
map_plant$samples_categ <- factor(map_plant$samples_categ, levels = c("1-5", 
                                                                      "6-10",
                                                                      "11-15",
                                                                      "16-20" ))
map_soil$year <- as.factor(map_soil$year)
map_plant <- map_plant %>% 
  filter(!is.na(samples_categ))
```

```{r sample map}
# samples collection map  
ggplot(data = world) +
  geom_sf(data = states, fill = NA) +
  geom_sf(data = counties, fill = NA) +
  geom_sf(data = map_plant, aes(fill = samples_categ) , alpha = 0.8) +
  geom_sf(data = map_soil, aes(shape = year),  size = 2) +
  coord_sf(xlim = c(-92, -87), ylim = c(36.5, 43), expand = FALSE) +
  scale_fill_manual(values = c("#a1dab4", "#41b6c4", "#2c7fb8", "#253494"), 
                    name = "Plant samples") +
  scale_shape_discrete(name = "Year") +
  theme_map()
```

# Identification of isolates

```{r exp isolates}
isolates.recovered %>% 
  group_by(year, source) %>% 
  count()

isolates.recovered %>% 
  group_by(identification) %>% 
  count() 
```


```{r figure species collected}
isolates.summary <- isolates.recovered %>% 
  select(species) %>%
  group_by(species) %>% 
  count() %>%  
  mutate(genus = case_when(
    grepl("Phyto", species) ~ "Phytophthora spp.",
    grepl("Pyth", species) ~"Pythium spp.")) %>% 
  mutate(percentage = (n/182)*100)

isolates.summary %>% 
  ggplot(aes(x = reorder(species, percentage), y = percentage, fill = genus))+
  geom_col() +
  coord_flip() +
  theme_minimal_hgrid()+
  labs(y = "Isolates (%)", 
       x = "Species") +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)))+
  theme_minimal_hgrid()+
  panel_border() +
  theme(legend.position = "none", 
        panel.grid.major.y = element_line(linetype = "dotted", 
                                          color = "grey80")) +
  scale_fill_manual(values = c("#FF6A6A", "#BEBEBE"))
```

# Pathotype

## Phytophthora sojae

```{r effective Rps}
# two susceptible controls
williams <- sojae %>% 
  filter(differential == "Williams") %>% 
  group_by(isolate_number, isolate_id, isolate_name, county, differential, gene) %>% 
  summarise(dead = sum(dead), 
            total = sum(total))

sojae <- sojae %>% 
  filter(!differential == "Williams")
sojae <- bind_rows(williams, sojae)
sojae <- sojae %>% 
  mutate(percent.susceptible = round((dead/total)*100))

hagis_args <- list(
  x = sojae,
  cutoff = 75,
  control = "rps",
  sample = "isolate_id",
  gene = "gene",
  perc_susc = "percent.susceptible"
)
# effective Rps
Rps.summary <- do.call(summarize_gene, hagis_args)
Rps.summary %>% 
  ggplot(aes(x = gene, y = percent_pathogenic)) +
  geom_col(fill = "#FF7256", alpha = 0.5) +
  theme_minimal_hgrid() +
  labs(x = "Rps gene", 
       y = "Percent pathogenic") +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05))) 
```

```{r complexity}
# mean complexity
complexities <- do.call(calculate_complexities, hagis_args)

complexity.percent <- complexities$grouped_complexities %>% 
  mutate(percent = (frequency/21)*100)

complexity.percent$complexity <- as.numeric(complexity.percent$complexity)
complexities$indvidual_complexities


complexity.percent %>% 
  ggplot(aes(x = complexity, y = percent)) +
  geom_col(fill = "#6495ED", alpha = 0.5) +
  theme_minimal_hgrid() +
  labs(x = "Complexity", 
       y = "Percent Isolates") +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05))) +
  scale_x_continuous(limits = c(1, 12), breaks = 1:12)

pander(summary(complexities))
```

```{r pathotype}
# diversity
do.call(calculate_diversities, hagis_args)
# pathotypes
diversities_table(diversity)
```

## Phytophthora sansomeana

```{r sansomena effective genes}
sansomeana <- sansomeana %>% 
  mutate(percent.susceptible = round((dead/total)*100))

sansomeana.rps <- summarize_gene(
  x = sansomeana,
  cutoff = 75,
  control = "rps",
  sample = "isolate_id",
  gene = "gene",
  perc_susc = "percent.susceptible"
)

sansomeana.rps %>% 
  ggplot(aes(x = gene, y = percent_pathogenic)) +
  geom_col(fill = "#FF7256", alpha = 0.5) +
  theme_minimal_hgrid() +
  labs(x = "Rps gene", 
       y = "Percent pathogenic") +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05))) 
```

# Aggressiveness

```{r area and length}
# some pots had two images in experiment 1 because they did it fit
area.length <- area.length %>% 
  group_by(experiment, pot) %>% 
  summarise(length_in = mean(length_in), 
            area_in.2 = mean(area_in.2))

aggressiveness <- left_join(dry.weigth, area.length, 
                            by = c("experiment", "pot")) 

# results  are by pot, divide by germination to get mean by seedling
aggressiveness <- aggressiveness %>% 
  mutate(shoot.mg = shoot.mg/germination, 
         root.mg = root.mg/germination, 
         length_in = length_in/germination, 
         area_in.2 = area_in.2/germination)
```

## Exploratory plots 

```{r exp plot 1}
aggressiveness$experiment <- as.factor(aggressiveness$experiment)
aggressiveness$isolate <- as.factor(aggressiveness$isolate)
aggressiveness$species <- as.factor(aggressiveness$species)

exp_plot <- function(y) {
  ggplot(data = aggressiveness, aes(x = experiment, y = .data[[y]])) +
    geom_boxplot(alpha = 0.6) +
    geom_point(aes(color =  experiment), position = position_jitter()) +
    theme_bw() +
    labs(x = "experiment", 
         y = y)
  }

exp_plot("shoot.mg")
exp_plot("root.mg")
exp_plot("length_in")
exp_plot("area_in.2")
```

```{r exp plot 2}
exp_plot_2 <- function(y) {
  ggplot(aggressiveness, aes(x = experiment, y = .data[[y]])) +
    geom_boxplot() +
    geom_point(aes(color =  experiment), position = position_jitter()) +
    facet_wrap(~species) +
    theme_bw()
}

exp_plot_2("root.mg")
exp_plot_2("shoot.mg")
exp_plot_2("length_in")
exp_plot_2("area_in.2")
```

```{r distribution}
qplot(shoot.mg, data = aggressiveness) +
  theme_bw()

qplot(root.mg, data = aggressiveness) +
  theme_bw()

qplot(length_in, data = aggressiveness) +
  theme_bw() # skew to the left, some transformation needed

qplot(area_in.2, data = aggressiveness) +
  theme_bw() # also skew
```

## Mix model and ANOVAs

```{r nesting}
aggressiveness <- aggressiveness %>% 
  mutate(species_isolate = paste(isolate, species, sep = "_")) # nest isolate in species
```

```{r fm root dry }
prueba <- aggressiveness %>% 
  filter(!species == "Control Agar", 
         !species == "Control None")
# experiment as random to account for variation between experiments 
fm.root.dry <- lmer(root.mg ~ species + species_isolate + (1|experiment), data = prueba)
resid_panel(fm.root.dry) # no assumptions violated 
anova(fm.root.dry)
```

```{r fm shoot dry }
fm.shoot.dry <- lmer(shoot.mg ~ species + species_isolate + (1|experiment), data = aggressiveness)
resid_panel(fm.shoot.dry) # most of the data points fall into the line 
anova(fm.root.dry)
```

```{r fm root length }
# log transformation for normality and slight difference in variances
fm.root.length <- lmer(log(length_in) ~ species + species_isolate + (1|experiment), data = aggressiveness)
resid_panel(fm.root.length) # transformation worked 
anova(fm.root.length)
```

```{r fm root area}
fm.root.area <- lmer(log(area_in.2) ~ species + species_isolate + (1|experiment), data = aggressiveness)
resid_panel(fm.root.area) # transformation also worked 
anova(fm.root.length)
```

## Differences between species 

```{r mean separation species}
emmeans(fm.root.dry, ~species) %>% 
  cld.emmGrid()

emmeans(fm.shoot.dry, ~species) %>% 
  cld.emmGrid()

emmeans(fm.root.length, ~species) %>% 
  cld.emmGrid()

emmeans(fm.root.area, ~species) %>% 
  cld.emmGrid()
```

```{r plot species}
species_plot <- function(y) {
  ggplot(data = aggressiveness, aes(x = species, y = .data[[y]])) +
    geom_boxplot(alpha = 0.6) +
    geom_point(aes(color =  experiment), position = position_jitter()) +
    theme_bw() +
    labs(x = "experiment", 
         y = y)
}

species_plot("root.mg")
species_plot("shoot.mg")
species_plot("length_in")
species_plot("area_in.2")
```

## Differences within species (between isolates)

```{r mean separation isolates}
emmeans(fm.root.dry, ~species_isolate) %>% 
  plot(comparisons = TRUE)

emmeans(fm.shoot.dry, ~species_isolate) %>% 
  plot(comparisons = TRUE)

emmeans(fm.root.length, ~species_isolate) %>% 
  plot(comparisons = TRUE)

emmeans(fm.root.area, ~species_isolate) %>% 
  plot(comparisons = TRUE)

```

```{r save means}

m.root.dry <- emmeans(fm.root.dry, ~species_isolate) %>% 
  tidy() %>% 
  select(species_isolate, 
         root.mg = estimate, 
         r.low = conf.low, 
         r.high = conf.high) 

m.shoot.dry <- emmeans(fm.shoot.dry, ~species_isolate) %>% 
  tidy()%>% 
  select(species_isolate, 
         shoot.mg = estimate, 
         s.low = conf.low, 
         s.high = conf.high) 

m.root.length <- emmeans(fm.root.length, ~species_isolate) %>% 
  tidy()%>% 
  select(species_isolate, 
         length.in = estimate, 
         l.low = conf.low, 
         l.high = conf.high) 

m.root.area <- emmeans(fm.root.area, ~species_isolate) %>% 
  tidy()%>% 
  select(species_isolate, 
         area.in2 = estimate, 
         a.low = conf.low, 
         a.high = conf.high) 

m.dry <- left_join(m.root.dry , m.shoot.dry, by = c("species_isolate")) 
m.scan <- left_join(m.root.length, m.root.area,by = c("species_isolate")) 

means.aggressiveness <- left_join(m.dry, m.scan, by = c("species_isolate")) %>% 
  separate(species_isolate, into = c("isolate", "species"), sep = "_")
```

https://ggplot2.tidyverse.org/reference/geom_linerange.html code from to 
add calculated CIs and means from emmeans 


```{r isolates plot}
ggplot(aggressiveness, aes(x = reorder(isolate_id, root.mg), y = root.mg, color = species)) + 
  geom_point(alpha = 0.2) +
  geom_jitter(colour = "gray50", alpha = 0.3, width = 0.1) +
  stat_summary(fun.data = "mean_cl_boot", 
               position = position_dodge(width = 0.5), 
               alpha = 0.7) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "bottom") +
  labs(x = "Isolate ID", 
       y = "Mean root dry weigth (mg)") 

```

## Correlation between aggressiveness and complexity 

```{r correlations}
# add complexity results
iso.complexity <- as.data.frame(complexities$indvidual_complexities) %>% 
  rename(isolate = sample, complexity = N_samp)

sojae.agg <- means.aggressiveness %>% 
  filter(species == "Phytophthora sojae") %>% 
  select(isolate, root.mg, shoot.mg, length.in, area.in2) 

sojae.all <- left_join(sojae.agg, iso.complexity, by = c("isolate"))

sojae.corr <- sojae.all %>%
  select(-isolate) %>%
  as.matrix() %>%
  rcorr(type = "pearson")

corrplot(sojae.corr$r, method = "number")
```

Make some plots for the temperature data, to see why the experiments are different or to validate the reason they are not

# Fungicide Sensitivity 

```{r prepare fs data}
# eliminate NAs
# average colony measurements 
clean_fungicide <- fungicide %>% 
  filter(!is.na(length_a)) %>%  
  mutate(length.mm = (length_a + length_b)/2) 

# subtract the plug diameter
clean_fungicide <- clean_fungicide %>% 
  mutate(length.mm = case_when(
    length.mm > 0 ~ length.mm - 4, 
    TRUE ~ length.mm - 0
    )) %>% 
  filter(!length.mm < 0) # eliminate any negative values 

# mean growth of control plate (dose 0)
control_fungicide <- clean_fungicide %>% 
  filter(dose == 0, 
         !is.na(length.mm)) %>% 
  group_by(fungicide, experiment, isolate) %>% 
  summarise(control.mean = mean(length.mm)) 

clean_fungicide <- left_join(clean_fungicide, control_fungicide, by = c("fungicide",
                                                                        "experiment", 
                                                                        "isolate"))
# relative growth calculation
clean_fungicide <- clean_fungicide %>% 
  mutate(rel.growth = (length.mm/control.mean)*100)
```

```{r filter fungicide}
# check if there are isolates with no EC50
# isolates with >50% rel growth in the higher dose 
no_EC50 <- clean_fungicide %>% 
  group_by(fungicide, experiment, isolate, dose) %>% 
  summarise(rel.growth = mean(rel.growth)) %>% 
  filter(fungicide %in% c("Mefenoxam",
                          "Metalaxyl", 
                          "Ethaboxam") & dose == 1 & rel.growth > 50, 
         fungicide == "Azoxystrobin" & dose == 10 & rel.growth > 50)

# check if there are isolates with hormetic effect
# >100% rel growth at lower dose
hormetic_isolates <- clean_fungicide %>% 
  group_by(fungicide, experiment, isolate, dose) %>% 
  summarise(rel.growth = mean(rel.growth)) %>% 
  filter(rel.growth > 100, 
         !dose == 0) %>% 
  dplyr::select(fungicide, experiment, isolate)

hormetic_isolates %>% 
  group_by(fungicide, experiment, isolate) %>% 
  n_distinct()

hormetic_data <- semi_join(clean_fungicide, hormetic_isolates)
```

```{r fit log logistic models }
# fit log-logistic models with 3 and 4 parameters 
nest_fungicide <- clean_fungicide %>% 
  group_by(fungicide, experiment, isolate) %>% 
  nest()

fit_LL3 <- function(dataset){
  drm(rel.growth ~ dose, fct = LL.3(), data = dataset)
}

fit_LL4 <- function(dataset){
  drm(rel.growth ~ dose, fct = LL.4(), data = dataset)
}

log_models <- nest_fungicide %>% 
  mutate(ll3.model = purrr::map(data, fit_LL3), 
         ll4.model = purrr::map(data, fit_LL4), 
         ll3.fit = purrr::map(ll3.model, mselect), 
         ll4.fit = purrr::map(ll4.model, mselect) 
         )
# mselect did not work inside function, use it individually to extract model fit info
```

```{r select best model}
log_selection <- log_models %>% 
  dplyr::select(ll3.fit, ll4.fit) %>% 
  gather(ll3.fit, ll4.fit, key = "model", value = "model.fit") %>%   
  unnest_wider(model.fit)

# select based on lower AIC
log_selection %>% 
  dplyr::select(fungicide, isolate, model, IC) %>% 
  spread(model, IC) %>% 
  filter(ll3.fit < ll4.fit) %>% 
  n_distinct()

# lack of fit p-values 
log_selection %>% 
  filter(`Lack of fit`  < 0.05) %>% 
  group_by(model)%>% 
  count() # LL.4 model better fit for most isolates
```

```{r EC50s}
# extract EC50s from LL.4 model
abs_EC50 <- function(models){
  ED(models, respLev = c(50), type = "absolute", interval = "delta")
}

log_models <- log_models %>% 
  mutate(ll4.EC50 = purrr::map(ll4.model, abs_EC50))

log_EC50 <- log_models %>% 
  dplyr::select(ll4.EC50) %>% 
  unnest_wider(ll4.EC50) %>% 
  rename(EC50 = ...1  , 
         std.error = ...2 ,
         lower = ...3, 
         upper = ...4)
```

```{r fit hormetic models}
nest_hormetic <- hormetic_data %>% 
  group_by(fungicide, experiment, isolate) %>% 
  nest()

fit_CRS <- function(dataset){
  drm(rel.growth ~ dose, fct = CRS.4c(), data = dataset)
}

fit_BC4 <- function(dataset){
  drm(rel.growth ~ dose, fct = BC.4(), data = dataset)
}

# fit hormetic models and compared it to LL.4
hormetic_models <- nest_hormetic %>% 
  mutate(crs.model = purrr::map(data, fit_CRS),
         bc4.model = purrr::map(data, fit_BC4 ),
         crs.fit = purrr::map(crs.model, mselect), 
         bc4.fit = purrr::map(bc4.model, mselect)
         )
```

```{r hormetic model selection}
hormetic_selection <- hormetic_models %>% 
  dplyr::select(crs.fit, bc4.fit)

hormetic_selection <- hormetic_selection %>% 
  gather(crs.fit, bc4.fit,  key = "model", value = "model.fit") %>%   
  unnest_wider(model.fit)

# add LL4 fit 
hormetic_selection <- semi_join(log_selection, hormetic_isolates) %>% 
  filter(model == "ll4.fit") %>% 
  bind_rows(hormetic_selection) %>% 
  arrange(isolate, IC)

# best hormetic model
hormetic_selection %>% 
  dplyr::select(fungicide, experiment, isolate, model, IC) %>% 
  spread(model, IC) %>% 
  filter(crs.fit > bc4.fit) %>% 
  n_distinct()
  
hormetic_selection %>% 
  dplyr::select(fungicide, experiment, isolate, model, IC) %>% 
  spread(model, IC) %>% 
  filter(ll4.fit > bc4.fit) %>% 
  n_distinct()
  
hormetic_selection %>% 
  filter(`Lack of fit` > 0.05) %>% 
  group_by(model) %>% 
  count() 
# overall bc4 better fit based on lower AIC
# no lack of fit for ll4 for most isolates with hormetic effect
# decide if its better to look > 0.05 or < 0.05
```

```{r combine data}
# check if 95 CI of exp 1 includes EC50 of exp 2
log_EC50$experiment <- as.factor(log_EC50$experiment)
log_EC50$isolate <- as.factor(log_EC50$isolate)

log_EC50 %>% 
  filter(!isolate == "13") %>% 
  ggplot(aes(x = isolate, y = EC50, color = experiment)) +
  geom_pointrange(aes(ymin = lower, ymax = upper), 
                  position = position_jitterdodge()) +
  facet_wrap(~ fungicide, scales = "free_y") +
  theme_minimal() +
  panel_border()

# distribution of EC50s in each experiment 
both_EC50 %>% 
  ggplot(aes(x = experiment, y = EC50, color = experiment)) +
  geom_boxplot() +
  facet_wrap(~ fungicide, scales = "free_y") +
  theme_minimal() +
  panel_border()
```

```{r LL.4 combine data }
# fit LL.4 model with pooled data
nest_pooled <- clean_fungicide %>% 
  group_by(fungicide, isolate) %>% 
  nest() 

log_pooled <- nest_pooled %>% 
  mutate(ll4.model = purrr::map(data, fit_LL4),
         ll4.fit = purrr::map(ll4.model, mselect), 
         abs.EC50 = purrr::map(ll4.model, abs_EC50)
         ) 

pooled_EC50 <- log_pooled %>% 
  dplyr::select(abs.EC50) %>% 
  unnest_wider(abs.EC50) %>% 
  rename(EC50 = ...1  , 
         std.error = ...2 ,
         lower = ...3, 
         upper = ...4) 
```

```{r pooled hormetic model}
# fit pool hormetic model
nest_hormetic_pooled <- hormetic_data %>% 
  group_by(fungicide, isolate) %>% 
  nest() 

hormetic_pooled <- nest_hormetic_pooled %>% 
  filter(!fungicide == "ethaboxam") # not working abs_Ec50 come back

hormetic_pooled <- hormetic_pooled %>% 
  mutate(bc4.model = purrr::map(data, fit_BC4),
         bc4.fit = purrr::map(bc4.model, mselect),
         abs.EC50 = purrr::map(bc4.model, abs_EC50)
         )

hormetic_EC50 <- hormetic_pooled %>% 
  dplyr::select(abs.EC50) %>% 
  unnest_wider(abs.EC50) %>% 
  rename(EC50 = ...1  , 
         std.error = ...2 ,
         lower = ...3, 
         upper = ...4) %>% 
  mutate(model = "BC4")
```

```{r compare EC50}
# compare hormetic EC50 with LL4 
compare_EC50 <- semi_join(pooled_EC50, hormetic_isolates) %>% 
  mutate(model = "LL4") 

compare_EC50 <- bind_rows(compare_EC50, hormetic_EC50)


compare_EC50$isolate <- as.factor(compare_EC50$isolate)

compare_EC50 %>% 
  filter(!fungicide == "ethaboxam") %>% 
  ggplot(aes(x = isolate, y = EC50, color = model)) +
  geom_pointrange(aes(ymin = lower, ymax = upper), 
                  position = position_jitterdodge()) +
  facet_wrap(~ fungicide, scales = "free") +
  theme_minimal() +
  panel_border()
```
