---
title: "Analysis Phytophthora spp. survey"
author: "Daniel Cerritos"
date: "4/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library}
# install.packages(c("cowplot", "googleway", "ggrepel","ggspatial", "libwgeom", "sf", "rnaturalearth", "rnaturalearthdata"))
# devtools::install_github("yutannihilation/ggsflabel")
library(here)
library(tidyverse)
library(ggplot2)
library(sf)
library(maps)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggrepel)
library(cowplot)
library(ggsflabel)
```

# Import data

```{r data}
# samples collection
soil.samples <- read_csv(here("output", "clean_data", "01_soil-samples-2016-2017_clean-data.csv"))
plant.samples <- read_csv(here("output", "clean_data", "01_plant-samples-2018_clean-data.csv"))
```

# Sample collection

```{r exp analysis}
# 2016-2017
soil.samples %>%
  group_by(year) %>% 
  count() 
soil.samples$county %>% 
  n_distinct() 

# 2018
plant.samples %>%
  count() 
plant.samples$county %>%
  n_distinct()

```

## Map

I use code from here: https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-2.html 

```{r samples map}
soil.samples <- soil.samples %>% 
  select(year, long, lat) %>% 
  filter(!is.na(long))

# convert to sf object
soil.samples <- st_as_sf(soil.samples, coords = c("long", "lat"), 
                   crs = 4326, agr = "constant")

soil.samples$year <- as.factor(soil.samples$year)

# subset county data 
world <- ne_countries(scale = "medium", returnclass = "sf")
states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

counties <- st_as_sf(map("county", plot = FALSE, fill = TRUE))
counties <- subset(counties, grepl("illinois", counties$ID))

# add plant samples data
counties <- counties %>% 
  separate(ID, into = c("state", "county"), sep = ",")

plant.samples <- plant.samples %>% 
  group_by(county) %>% 
  count() %>% 
  rename(plant_samples = n)

plant.samples$county <- tolower(plant.samples$county)
 
all_data <- left_join(counties, plant.samples, by = "county")

# map 
ggplot(data = world) +
  geom_sf(data = states, fill = NA) + 
  geom_sf(data = all_data, aes(fill = plant_samples), color = "black") +
  geom_sf(data = soil.samples, aes(shape = year),  size = 4) +
  coord_sf(xlim = c(-92, -87), ylim = c(36.5, 43), expand = FALSE) +
  scale_fill_gradient(high = "#2171b5", low = "#bdd7e7", na.value = "gay01") +
  theme_map()
```



